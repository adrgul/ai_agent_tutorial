<mxfile host="65bd71144e">
    <diagram name="AI Agent Complex - MCP &amp; LangGraph Architecture" id="mcp-langgraph-architecture">
        <mxGraphModel dx="2559" dy="310" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="2200" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="AI Agent Complex - LangGraph Architecture with MCP Integration" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#000000;" parent="1" vertex="1">
                    <mxGeometry x="200" y="20" width="2000" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="subtitle" value="RAG Pipeline â€¢ MCP Integration (AlphaVantage 118 tools + DeepWiki 3 tools) â€¢ Parallel Execution (asyncio.gather) â€¢ Plan-and-Execute â€¢ Dynamic Routing â€¢ State Reducers â€¢ MAX_ITERATIONS=20 | âœ… PRODUCTION READY" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=2;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="200" y="75" width="2000" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="main_label" value="MAIN AGENT WORKFLOW (Reference)" style="text;html=1;strokeColor=#666666;fillColor=#F0F0F0;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=18;fontStyle=1;fontColor=#666666;strokeWidth=2;" parent="1" vertex="1">
                    <mxGeometry x="-460" y="290" width="380" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="start_main" value="START&#xa;(User Message)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;strokeWidth=3;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="-380" y="345" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="rag_pipeline" value="RAG Pipeline (Subgraph)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_graph.py&#xa;Function: create_rag_subgraph()&#xa;Lines: [16-58]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ChromaDB + OpenAI embeddings&#xa;See RAG detail in top-right inset â†’" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-410" y="465" width="260" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="fetch_av" value="Fetch AlphaVantage Tools&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _fetch_alphavantage_tools_node()&#xa;Lines: [199-255]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Server: mcp.alphavantage.co/mcp&#xa;Protocol: JSON-RPC 2.0&#xa;Result: 118 financial tools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-410" y="635" width="260" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="fetch_dw" value="Fetch DeepWiki Tools&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _fetch_deepwiki_tools_node()&#xa;Lines: [257-312]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Server: mcp.deepwiki.com/mcp&#xa;Protocol: JSON-RPC 2.0&#xa;Result: 3 knowledge tools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-410" y="855" width="260" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="agent_decide" value="Agent Decide&#xa;(LLM Reasoning + RAG)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _agent_decide_node()&#xa;Lines: [314-503]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;â€¢ Analyzes user query + RAG context&#xa;â€¢ Reviews available tools (MCP + local)&#xa;â€¢ Decides: single tool, parallel, OR final&#xa;â€¢ Tracks iteration_count (MAX_ITERATIONS=20)&#xa;â€¢ Prevents duplicate tool calls" style="rhombus;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;strokeWidth=4;fontSize=11;align=center;" parent="1" vertex="1">
                    <mxGeometry x="-440" y="1095" width="320" height="300" as="geometry"/>
                </mxCell>
                <mxCell id="mcp_exec" value="MCP Tool Execution (Single)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _mcp_tool_execution_node()&#xa;Lines: [699-756]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Executes: 1 AlphaVantage OR DeepWiki tool&#xa;Timeout: 30 seconds&#xa;Returns: SystemMessage with result" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-410" y="1465" width="260" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="parallel_exec" value="Parallel Tool Execution&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _parallel_tool_execution_node()&#xa;Lines: [758-806]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ PARALLEL MCP CALLS&#xa;Helper: execute_parallel_mcp_tools()&#xa;  File: backend/services/parallel_execution.py&#xa;  Lines: [14-96]&#xa;Uses: asyncio.gather() [Line 93]&#xa;Reducer: parallel_results_reducer&#xa;Performance: 2-6x speedup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-90" y="1465" width="280" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="builtin_tools" value="Built-in Tools (Local - 7 tools)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _create_tool_node(tool_name)&#xa;Lines: [653-697]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;1. weather (Open-Meteo API)&#xa;2. geocode (Nominatim)&#xa;3. ip_geolocation (ipapi.co)&#xa;4. fx_rates (Frankfurter API)&#xa;5. crypto_price (CoinGecko)&#xa;6. create_file (local filesystem)&#xa;7. search_history (local JSON)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-1210" y="1405" width="280" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="agent_finalize" value="Agent Finalize&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/agent.py&#xa;Method: _agent_finalize_node()&#xa;Lines: [808-866]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Generates natural language response&#xa;Integrates all tool results + memory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="-410" y="1725" width="260" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="end_main" value="END&#xa;(Response to User)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#CCE5FF;strokeColor=#0066CC;strokeWidth=3;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="-380" y="1915" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m1" parent="1" source="start_main" target="rag_pipeline" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m2" parent="1" source="rag_pipeline" target="fetch_av" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m3" parent="1" source="fetch_av" target="fetch_dw" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m4" parent="1" source="fetch_dw" target="agent_decide" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m5" value="action: call_tool" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="agent_decide" target="mcp_exec" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m6" value="action: call_tools_parallel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="agent_decide" target="parallel_exec" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-280" y="1415"/>
                            <mxPoint x="50" y="1415"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m7" value="action: use_tool (local)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="agent_decide" target="builtin_tools" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="330" y="1080"/>
                            <mxPoint x="840" y="1080"/>
                            <mxPoint x="840" y="1300"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m8" value="action: final_answer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="agent_decide" target="agent_finalize" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_m9" value="Loop (multi-step)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="mcp_exec" target="agent_decide" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-440" y="1555"/>
                            <mxPoint x="-440" y="1245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m10" value="Loop (multi-step)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="parallel_exec" target="agent_decide" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="50" y="1435"/>
                            <mxPoint x="-110" y="1435"/>
                            <mxPoint x="-110" y="1245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m11" value="Loop (multi-step)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="builtin_tools" target="agent_decide" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-890" y="1565"/>
                            <mxPoint x="-890" y="1245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_m12" parent="1" source="agent_finalize" target="end_main" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rag_container" value="RAG SUBGRAPH PIPELINE" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFFFF0;strokeColor=#B8860B;strokeWidth=3;fontSize=16;fontStyle=1;startSize=40;" parent="1" vertex="1">
                    <mxGeometry x="1080" y="130" width="1280" height="260" as="geometry"/>
                </mxCell>
                <mxCell id="rag_1" value="query_rewrite&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_nodes.py&#xa;Method: query_rewrite_node()&#xa;Line: 45&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Optimizes query for retrieval" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=10;align=left;spacingLeft=8;" parent="rag_container" vertex="1">
                    <mxGeometry x="20" y="60" width="200" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="rag_2" value="retrieve&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_nodes.py&#xa;Method: retrieve_node()&#xa;Line: 147&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ChromaDB vector search&#xa;Top-K: 4, Threshold: 0.7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=10;align=left;spacingLeft=8;" parent="rag_container" vertex="1">
                    <mxGeometry x="270" y="60" width="210" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="rag_3" value="context_builder&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_nodes.py&#xa;Method: context_builder_node()&#xa;Line: 203&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Builds citations &amp; context&#xa;Max tokens: 2000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=10;align=left;spacingLeft=8;" parent="rag_container" vertex="1">
                    <mxGeometry x="530" y="60" width="210" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="rag_4" value="guardrail&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_nodes.py&#xa;Method: guardrail_node()&#xa;Line: 263&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Validation &amp; formatting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=10;align=left;spacingLeft=8;" parent="rag_container" vertex="1">
                    <mxGeometry x="790" y="60" width="200" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="rag_5" value="feedback&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/rag/rag_nodes.py&#xa;Method: feedback_node()&#xa;Line: 291&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Metrics aggregation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFCC;strokeColor=#B8860B;strokeWidth=2;fontSize=10;align=left;spacingLeft=8;" parent="rag_container" vertex="1">
                    <mxGeometry x="1040" y="60" width="200" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="rag_arrow1" parent="rag_container" source="rag_1" target="rag_2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rag_arrow2" parent="rag_container" source="rag_2" target="rag_3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rag_arrow3" parent="rag_container" source="rag_3" target="rag_4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="rag_arrow4" parent="rag_container" source="rag_4" target="rag_5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="adv_label" value="âœ… ADVANCED AGENT WORKFLOW (ACTIVE)" style="text;html=1;strokeColor=#009900;fillColor=#CCFFCC;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=18;fontStyle=1;fontColor=#006600;strokeWidth=3;" parent="1" vertex="1">
                    <mxGeometry x="910" y="430" width="450" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="start_adv" value="START&#xa;(Advanced Agent)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=3;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="1030" y="485" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="adv_fetch_av" value="Fetch AlphaVantage Tools&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      mcp_nodes.py&#xa;Class: MCPToolFetcherNode&#xa;Method: __call__()&#xa;Lines: [28-94]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Server: mcp.alphavantage.co/mcp&#xa;Protocol: JSON-RPC 2.0&#xa;Result: 118 financial tools&#xa;Stores: state[&#39;alphavantage_tools&#39;]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="990" y="595" width="280" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="adv_fetch_dw" value="Fetch DeepWiki Tools&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      mcp_nodes.py&#xa;Class: MCPToolFetcherNode&#xa;Method: __call__()&#xa;Lines: [28-94]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Server: mcp.deepwiki.com/mcp&#xa;Protocol: JSON-RPC 2.0&#xa;Result: 3 knowledge tools&#xa;Stores: state[&#39;deepwiki_tools&#39;]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="990" y="835" width="280" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="adv_router" value="Router (Dynamic Routing)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      routing/router.py&#xa;Class: DynamicRouter [L76-250]&#xa;Method: __call__()&#xa;Lines: [101-238]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;LLM decides routing path based on:&#xa;â€¢ User query + RAG context&#xa;â€¢ Available MCP tools (AlphaVantage/DeepWiki)&#xa;â€¢ Task complexity &amp; dependencies&#xa;Routes to: planner, fan_out,&#xa;  mcp_tool_execution,&#xa;  mcp_parallel_execution,&#xa;  aggregator, direct_response, END" style="rhombus;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=4;fontSize=11;align=center;" parent="1" vertex="1">
                    <mxGeometry x="930" y="1075" width="340" height="340" as="geometry"/>
                </mxCell>
                <mxCell id="adv_mcp_parallel" value="MCP Parallel Execution&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      mcp_nodes.py&#xa;Class: MCPParallelExecutionNode&#xa;Method: __call__()&#xa;Lines: [203-285]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ PARALLEL MCP CALLS&#xa;Helper: execute_parallel_mcp_tools()&#xa;  File: backend/services/parallel_execution.py&#xa;  Lines: [14-96]&#xa;Uses: asyncio.gather() [Line 93]&#xa;Performance: 2-6x speedup&#xa;Loop-back: Returns to Router" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="1310" y="1835" width="290" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="adv_planner" value="Planner&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      planning/planner.py&#xa;Class: PlannerNode&#xa;Method: __call__()&#xa;Lines: [81-160]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;LLM generates ExecutionPlan:&#xa;â€¢ Sequential steps with dependencies&#xa;â€¢ can_run_parallel flag&#xa;â€¢ Expected output per step&#xa;â€¢ Tool selection for each step" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="980" y="2360" width="240" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="adv_executor" value="Executor&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      planning/executor.py&#xa;Class: ExecutorNode&#xa;Method: __call__()&#xa;Lines: [82-260]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Executes plan steps sequentially&#xa;â€¢ Checks dependencies&#xa;â€¢ Retries on failure (max 3)&#xa;â€¢ Updates plan_results&#xa;â€¢ Sets plan_completed flag" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="150" y="2390" width="240" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="adv_fanout" value="Fan-Out (Spawn Parallel Tasks)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      parallel/fan_out.py&#xa;Class: FanOutNode&#xa;Method: __call__()&#xa;Lines: [56-100]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Validates task independence&#xa;Sets parallel_execution_active=True" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="1580" y="700" width="260" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="parallel_zone" value="PARALLEL EXECUTION ZONE" style="swimlane;whiteSpace=wrap;html=1;fillColor=#F5E6FF;strokeColor=#9900FF;strokeWidth=4;fontSize=14;fontStyle=1;startSize=35;" parent="1" vertex="1">
                    <mxGeometry x="1530" y="1260" width="380" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="ptask1" value="Tool Weather&#xa;(Branch 1)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=2;fontSize=10;" parent="parallel_zone" vertex="1">
                    <mxGeometry x="20" y="55" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ptask2" value="Tool FX Rates&#xa;(Branch 2)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=2;fontSize=10;" parent="parallel_zone" vertex="1">
                    <mxGeometry x="140" y="55" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ptask3" value="Tool Crypto&#xa;(Branch 3)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=2;fontSize=10;" parent="parallel_zone" vertex="1">
                    <mxGeometry x="260" y="55" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="parallel_note" value="asyncio.gather()&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/services/parallel_execution.py&#xa;Function: execute_parallel_mcp_tools()&#xa;Line: 93&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;â€¢ Concurrent execution&#xa;â€¢ Task isolation&#xa;â€¢ Error handling per task&#xa;â€¢ Partial failure support&#xa;&#xa;Performance: 2-6x speedup&#xa;Example: 3 tasks @ 2s = 2s total" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontFamily=Courier New;" parent="parallel_zone" vertex="1">
                    <mxGeometry x="20" y="130" width="340" height="135" as="geometry"/>
                </mxCell>
                <mxCell id="adv_fanin" value="Fan-In (Aggregate Results)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      parallel/fan_in.py&#xa;Class: FanInNode&#xa;Method: __call__()&#xa;Lines: [68-138]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Uses parallel_results_reducer()&#xa;Merges concurrent task results&#xa;Strategies: concat, dict, summary" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6CCFF;strokeColor=#9900FF;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="1650" y="2010" width="260" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="adv_aggregator" value="Aggregator (Result Synthesis)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      aggregation/aggregator.py&#xa;Class: ResultAggregator&#xa;Method: __call__()&#xa;Lines: [88-195]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Synthesizes final_answer from:&#xa;â€¢ parallel_results&#xa;â€¢ plan_results&#xa;â€¢ messages history&#xa;Uses LLM for natural language" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="780" y="1835" width="240" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="adv_direct" value="Direct Response&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      advanced_graph.py&#xa;Method: _direct_response_node()&#xa;Line: 406&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Bypasses planning" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=2;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="560" y="665" width="220" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="end_adv" value="END&#xa;(Advanced Agent)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#CCFFCC;strokeColor=#009900;strokeWidth=3;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="470" y="1755" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a0_1" parent="1" source="start_adv" target="adv_fetch_av" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a0_2" parent="1" source="adv_fetch_av" target="adv_fetch_dw" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a0_3" parent="1" source="adv_fetch_dw" target="adv_router" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a1" value="route: mcp_tool_execution" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_router" target="adv_mcp_single" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a1b" value="route: mcp_parallel_execution" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_router" target="adv_mcp_parallel" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a1_loop1" value="Loop (multi-step)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="adv_mcp_single" target="adv_router" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="510" y="1560"/>
                            <mxPoint x="510" y="1245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a1_loop2" value="Loop (multi-step)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="adv_mcp_parallel" target="adv_router" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1035" y="1735"/>
                            <mxPoint x="1360" y="1735"/>
                            <mxPoint x="1360" y="1245"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a2" value="route: planner" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_router" target="adv_planner" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a3" style="exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="adv_planner" target="adv_executor" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1100" y="2145" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a4" value="Loop (continue)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;endArrow=block;endFill=1;curved=1;fontSize=10;strokeColor=#0000FF;" parent="1" source="adv_executor" target="adv_executor" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="580" y="2075"/>
                            <mxPoint x="910" y="2075"/>
                            <mxPoint x="910" y="2360"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a5" value="route: complete" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_executor" target="adv_aggregator" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1030" y="1455"/>
                            <mxPoint x="1110" y="1455"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a6" value="route: fan_out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_router" target="adv_fanout" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;endArrow=block;endFill=1;strokeColor=#9900FF;" parent="1" source="adv_fanout" target="parallel_zone" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=4;endArrow=block;endFill=1;strokeColor=#9900FF;" parent="1" source="parallel_zone" target="adv_fanin" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a9" parent="1" source="adv_fanin" target="adv_aggregator" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1250" y="2040"/>
                            <mxPoint x="1250" y="1930"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a10" value="route: direct_response" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=block;endFill=1;dashed=1;dashPattern=8 8;fontSize=11;" parent="1" source="adv_router" target="adv_direct" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow_a11" parent="1" source="adv_direct" target="end_adv" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="860" y="1575"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow_a12" parent="1" source="adv_mcp_single" target="end_adv" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="mcp_container" value="MCP INTEGRATION DETAILS - JSON-RPC 2.0 Protocol" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#FF6600;strokeWidth=4;fontSize=16;fontStyle=1;startSize=40;" parent="1" vertex="1">
                    <mxGeometry x="-20" y="2660" width="1840" height="480" as="geometry"/>
                </mxCell>
                <mxCell id="mcp_client" value="MCPClient Class&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/infrastructure/tool_clients.py&#xa;Lines: [272-496]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;Methods:&#xa;&#xa;â€¢ connect(server_url) [L285-373]&#xa;  JSON-RPC 2.0 initialize&#xa;  UUID session ID, Protocol: 2025-03-26&#xa;&#xa;â€¢ list_tools() [L375-437]&#xa;  JSON-RPC tools/list&#xa;  Header: Mcp-Session-Id&#xa;&#xa;â€¢ call_tool(name, args) [L439-486]&#xa;  JSON-RPC tools/call&#xa;  Timeout: 30 seconds&#xa;&#xa;â€¢ disconnect() [L488-495]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=2;fontSize=10;align=left;spacingLeft=10;fontFamily=Courier New;" parent="mcp_container" vertex="1">
                    <mxGeometry x="20" y="60" width="420" height="420" as="geometry"/>
                </mxCell>
                <mxCell id="mcp_servers" value="MCP Servers&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;1. AlphaVantage MCP&#xa;   URL: https://mcp.alphavantage.co/mcp?apikey=...&#xa;   Tools: 118 financial tools&#xa;   Categories:&#xa;   â€¢ Stock prices (QUOTE, TIME_SERIES_*)&#xa;   â€¢ Forex rates (CURRENCY_EXCHANGE_RATE)&#xa;   â€¢ Crypto prices (DIGITAL_CURRENCY_*)&#xa;   â€¢ Economic indicators (GDP, INFLATION, etc.)&#xa;   â€¢ Technical indicators (SMA, EMA, RSI, etc.)&#xa;&#xa;2. DeepWiki MCP&#xa;   URL: https://mcp.deepwiki.com/mcp&#xa;   Tools: 3 knowledge tools&#xa;   â€¢ ask_question&#xa;   â€¢ read_wiki_structure&#xa;   â€¢ get_wiki_content&#xa;   Status: Currently returns 404 (not available)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=2;fontSize=10;align=left;spacingLeft=10;fontFamily=Courier New;" parent="mcp_container" vertex="1">
                    <mxGeometry x="480" y="60" width="600" height="410" as="geometry"/>
                </mxCell>
                <mxCell id="mcp_protocol" value="Protocol Flow&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;1. Initialize Connection&#xa;   POST /mcp&#xa;   Method: initialize&#xa;   Params: {&#xa;     protocolVersion: &#39;2025-03-26&#39;,&#xa;     clientInfo: {...}&#xa;   }&#xa;   Timeout: 15 seconds&#xa;&#xa;2. Send Initialized Notification&#xa;   Method: initialized&#xa;&#xa;3. List Available Tools&#xa;   Method: tools/list&#xa;   Header: Mcp-Session-Id: {uuid}&#xa;&#xa;4. Call Tool&#xa;   Method: tools/call&#xa;   Params: {&#xa;     name: &#39;tool_name&#39;,&#xa;     arguments: {...}&#xa;   }&#xa;   Timeout: 30 seconds&#xa;&#xa;5. Disconnect (optional)&#xa;   Close connection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=2;fontSize=10;align=left;spacingLeft=10;fontFamily=Courier New;" parent="mcp_container" vertex="1">
                    <mxGeometry x="1110" y="50" width="700" height="420" as="geometry"/>
                </mxCell>
                <mxCell id="state_container" value="STATE MANAGEMENT &amp; REDUCERS" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E8F5FF;strokeColor=#0033CC;strokeWidth=4;fontSize=16;fontStyle=1;startSize=40;" parent="1" vertex="1">
                    <mxGeometry x="1960" y="430" width="400" height="820" as="geometry"/>
                </mxCell>
                <mxCell id="state_info" value="Concurrent State Updates&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/state.py&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;&#xa;State Fields with Reducers:&#xa;&#xa;1. parallel_results&#xa;   Type: Annotated[List[Dict],&#xa;                    parallel_results_reducer]&#xa;   Reducer: [L72-99]&#xa;   Purpose: Deduplicates by task_id&#xa;   Why: Multiple parallel branches emit&#xa;        results; reducer ensures each&#xa;        task appears only once&#xa;&#xa;2. aggregated_data&#xa;   Type: Annotated[Dict, dict_merge_reducer]&#xa;   Reducer: [L53-69]&#xa;   Purpose: Merges dicts from parallel&#xa;   Why: Different tools produce different&#xa;        keys; reducer combines without&#xa;        data loss&#xa;&#xa;3. messages&#xa;   Type: Annotated[Sequence[BaseMessage],&#xa;                    list_reducer]&#xa;   Reducer: [L36-50]&#xa;   Purpose: Appends new messages&#xa;   Why: Conversation history from all&#xa;        branches&#xa;&#xa;4. plan_results&#xa;   Type: Annotated[List[Dict], list_reducer]&#xa;   Purpose: Collects results from plan&#xa;            steps&#xa;&#xa;5. debug_logs&#xa;   Type: Annotated[List[str], list_reducer]&#xa;   Purpose: Aggregates logs from all nodes&#xa;&#xa;6. tools_called&#xa;   Type: Annotated[List[Dict], list_reducer]&#xa;   Purpose: Tracks all tool invocations&#xa;&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;How Reducers Work:&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;When 3 parallel nodes emit updates:&#xa;  Node A: parallel_results += [{task_A}]&#xa;  Node B: parallel_results += [{task_B}]&#xa;  Node C: parallel_results += [{task_C}]&#xa;&#xa;LangGraph calls reducer 3 times:&#xa;  result = reducer([], [{task_A}])&#xa;  result = reducer(result, [{task_B}])&#xa;  result = reducer(result, [{task_C}])&#xa;&#xa;Final state: [{task_A}, {task_B}, {task_C}]&#xa;&#xa;âš ï¸  Without reducers: Only last update&#xa;    survives! Result: [{task_C}] âŒ&#xa;&#xa;âœ… Reducers enable safe concurrent&#xa;   updates" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontFamily=Courier New;" parent="state_container" vertex="1">
                    <mxGeometry x="15" y="60" width="370" height="750" as="geometry"/>
                </mxCell>
                <mxCell id="legend_container" value="LEGEND" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=3;fontSize=16;fontStyle=1;startSize=35;" parent="1" vertex="1">
                    <mxGeometry x="1960" y="1300" width="400" height="720" as="geometry"/>
                </mxCell>
                <mxCell id="legend_colors" value="Node Colors:&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”µ Light Blue (#CCE5FF)&#xa;   Main Agent nodes&#xa;&#xa;ðŸŸ¢ Light Green (#CCFFCC)&#xa;   Advanced Agent nodes&#xa;&#xa;ðŸŸ¡ Light Yellow (#FFFFCC)&#xa;   RAG Pipeline nodes&#xa;&#xa;ðŸŸ  Light Orange (#FFDDAA)&#xa;   MCP-related nodes&#xa;&#xa;ðŸŸ£ Light Purple (#E6CCFF)&#xa;   Parallel execution&#xa;&#xa;â¬œ White/Gray&#xa;   Decision/routing diamonds&#xa;&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="legend_container" vertex="1">
                    <mxGeometry x="20" y="50" width="360" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="legend_arrows" value="Arrow Types:&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;â†’  Solid Arrow&#xa;   Sequential flow&#xa;&#xa;â‡¢  Dashed Arrow&#xa;   Conditional flow&#xa;&#xa;â†»  Curved Arrow (blue)&#xa;   Loop back (multi-step)&#xa;&#xa;â‡‰  Thick Purple&#xa;   Parallel spawn/merge&#xa;&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="legend_container" vertex="1">
                    <mxGeometry x="20" y="280" width="360" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="legend_highlights" value="Highlights:&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ Orange Border (thick)&#xa;   MCP calling points&#xa;   (connect, list, call)&#xa;&#xa;ðŸŸ£ Purple Border (thick)&#xa;   Parallel execution zones&#xa;   (fan-out, tasks, fan-in)&#xa;&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;&#xa;All nodes include:&#xa;â€¢ File path (relative to root)&#xa;â€¢ Method/function name&#xa;â€¢ Line numbers [start-end]&#xa;â€¢ Purpose/description&#xa;&#xa;This enables direct code&#xa;navigation for implementation." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="legend_container" vertex="1">
                    <mxGeometry x="20" y="470" width="360" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="footer" value="Updated: 2026-01-14 | AI Agent Complex v2.0 | RAG (ChromaDB) + LangGraph + MCP (AlphaVantage 118 tools, DeepWiki 3 tools) + Parallel Execution (asyncio.gather) | MAX_ITERATIONS=20 | State Reducers | âœ… PRODUCTION READY | Docs: docs/ARCHITECTURE.md, ADVANCED_AGENT_TEST_PROMPTS.md" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry y="3310" width="2000" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="1hhYCXpkVwavpmy8BzVo-2" value="" parent="1" source="adv_aggregator" target="adv_mcp_single" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="780" y="1881" as="sourcePoint"/>
                        <mxPoint x="640" y="1824" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="adv_mcp_single" value="MCP Tool Execution (Single)&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;File: backend/advanced_agents/&#xa;      mcp_nodes.py&#xa;Class: MCPToolExecutionNode&#xa;Method: __call__()&#xa;Lines: [97-200]&#xa;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”&#xa;ðŸ”¶ MCP CALL POINT&#xa;Executes: 1 AlphaVantage OR DeepWiki tool&#xa;Timeout: 30 seconds&#xa;Returns: SystemMessage with result&#xa;Loop-back: Returns to Router" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFDDAA;strokeColor=#FF6600;strokeWidth=4;fontSize=11;align=left;spacingLeft=10;" parent="1" vertex="1">
                    <mxGeometry x="490" y="1150" width="280" height="210" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>